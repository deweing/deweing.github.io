<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta property="og:type" content="website">
<meta property="og:title" content="Hello World">
<meta property="og:url" content="http://deweing.github.io/index.html">
<meta property="og:site_name" content="Hello World">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hello World">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://deweing.github.io/"/>





  <title> Hello World </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hello World</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://deweing.github.io/2017/12/18/change-docker-lib-dir/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="DW">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars1.githubusercontent.com/u/2382711">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hello World">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/12/18/change-docker-lib-dir/" itemprop="url">
                  修改Docker存储位置
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-19T00:00:00+08:00">
                2017-12-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/docker/" itemprop="url" rel="index">
                    <span itemprop="name">docker</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在默认情况下，Docker镜像和容器的默认存放位置为:/var/lib/docker</p>
<h1 id="方法一：挂载新分区到-var-lib-docker目录下"><a href="#方法一：挂载新分区到-var-lib-docker目录下" class="headerlink" title="方法一：挂载新分区到/ var/lib/docker目录下"></a>方法一：挂载新分区到/ var/lib/docker目录下</h1><h3 id="1-创建新分区"><a href="#1-创建新分区" class="headerlink" title="1.创建新分区"></a>1.创建新分区</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">fdisk -l</div><div class="line">fdisk /dev/sdc</div><div class="line">mkfs -t ext4 /dev/sdc1</div><div class="line">#临时挂载新分区</div><div class="line">mkdir /mnt/docker</div><div class="line">mount /dev/sdc1 /mnt/docker</div></pre></td></tr></table></figure>
<h3 id="2-停止docker服务，cp目录"><a href="#2-停止docker服务，cp目录" class="headerlink" title="2.停止docker服务，cp目录"></a>2.停止docker服务，cp目录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">service docker stop</div><div class="line">cp -r /var/lib/docker/* /mnt/docker</div></pre></td></tr></table></figure>
<h3 id="3-挂载新分区到-var-lib-docker"><a href="#3-挂载新分区到-var-lib-docker" class="headerlink" title="3.挂载新分区到/var/lib/docker"></a>3.挂载新分区到/var/lib/docker</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">#备份原目录</div><div class="line">mv /var/lib/docker&#123;,.bak&#125;</div><div class="line">#创建新目录</div><div class="line">mkdir /var/lib/docker</div><div class="line"></div><div class="line">mount /dev/sdc1 /var/lib/docker</div><div class="line">unmout /mnt/docker</div></pre></td></tr></table></figure>
<p>设置开机自动挂载<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">vim /etc/fstab</div><div class="line"></div><div class="line">#添加以下命令</div><div class="line">---</div><div class="line">/dev/sdc1 /var/lib/docker ext4 defaults 1 1</div></pre></td></tr></table></figure></p>
<h3 id="4-启动docker，验证"><a href="#4-启动docker，验证" class="headerlink" title="4.启动docker，验证"></a>4.启动docker，验证</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">service docker start</div><div class="line">docker images</div><div class="line">docker ps -a</div></pre></td></tr></table></figure>
<h1 id="方法二：修改容器和镜像的存储位置"><a href="#方法二：修改容器和镜像的存储位置" class="headerlink" title="方法二：修改容器和镜像的存储位置"></a>方法二：修改容器和镜像的存储位置</h1><p>在Docker服务配置文件/etc/sysconfig/docker中修改镜像和容器存放路径的参数， 在配置文件中加入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">other_args=&quot;--graph=/data/docker&quot;。</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://deweing.github.io/2017/11/06/is-2-power/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="DW">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars1.githubusercontent.com/u/2382711">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hello World">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/11/06/is-2-power/" itemprop="url">
                  简单的算法，是否为2的乘方
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-07T00:00:00+08:00">
                2017-11-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/algorithm/" itemprop="url" rel="index">
                    <span itemprop="name">algorithm</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="简单的算法"><a href="#简单的算法" class="headerlink" title="简单的算法"></a>简单的算法</h1><h4 id="1-判断一个正数是否是2的乘方-比如16是2的4次方-。"><a href="#1-判断一个正数是否是2的乘方-比如16是2的4次方-。" class="headerlink" title="1.判断一个正数是否是2的乘方(比如16是2的4次方)。"></a>1.判断一个正数是否是2的乘方(比如16是2的4次方)。</h4><p>思路：<br>如果一个整数是2的乘方，那么转换为二进制，只有最高位为1；<br>把这个整数减一，转换为二进制，所有位都为1;<br>两者相与，则等于0</p>
<table>
<thead>
<tr>
<th>十进制</th>
<th>二进制</th>
<th>N-1</th>
<th>是否2的乘方</th>
</tr>
</thead>
<tbody>
<tr>
<td>8</td>
<td>1000</td>
<td>111</td>
<td>是</td>
</tr>
<tr>
<td>16</td>
<td>10000</td>
<td>1111</td>
<td>是</td>
</tr>
<tr>
<td>32</td>
<td>100000</td>
<td>11111</td>
<td>是</td>
</tr>
<tr>
<td>64</td>
<td>1000000</td>
<td>111111</td>
<td>是</td>
</tr>
<tr>
<td>100</td>
<td>1100100</td>
<td>1100011</td>
<td>否</td>
</tr>
</tbody>
</table>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_2_power</span><span class="params">(num)</span>:</span></div><div class="line">    <span class="keyword">return</span> (num &amp; num <span class="number">-1</span>) == <span class="number">0</span></div></pre></td></tr></table></figure>
<h4 id="2-求出一个正整数转换成二进制后的数字“1”的个数"><a href="#2-求出一个正整数转换成二进制后的数字“1”的个数" class="headerlink" title="2.求出一个正整数转换成二进制后的数字“1”的个数"></a>2.求出一个正整数转换成二进制后的数字“1”的个数</h4><p>思路：<br>当然，也应该与位运算有关了。<br>一个数N，N&amp;1 要么是0，要么是1。<br>所以，结果为1时，说明最低位是1。为0时，说明最低位不是1。<br>因此，每次&amp;后，都右移一位，再次&amp;，直到N右移为0时，结束循环。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">count_1</span><span class="params">(num)</span>:</span></div><div class="line">    cnt = <span class="number">0</span></div><div class="line">    <span class="keyword">while</span> num:</div><div class="line">        <span class="keyword">if</span> (num &amp; <span class="number">1</span>):</div><div class="line">            cnt += <span class="number">1</span></div><div class="line">        num = num &gt;&gt; <span class="number">1</span></div><div class="line">    <span class="keyword">return</span> cnt</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://deweing.github.io/2017/05/22/docker-entrypoint-cmd/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="DW">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars1.githubusercontent.com/u/2382711">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hello World">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/22/docker-entrypoint-cmd/" itemprop="url">
                  Docker中的CMD和ENTRYPOINT区别
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-23T00:00:00+08:00">
                2017-05-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-CMD"><a href="#1-CMD" class="headerlink" title="1.CMD"></a>1.CMD</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">The main purpose of a CMD is to provide defaults for an executing container.</div><div class="line">CMD在容器运行的时候提供一些命令及参数，用法如下：</div><div class="line"></div><div class="line">1.CMD [&quot;executable&quot;,&quot;param1&quot;,&quot;param2&quot;] (exec form, this is the preferred form)</div><div class="line">2.CMD [&quot;param1&quot;,&quot;param2&quot;] (as default parameters to ENTRYPOINT)</div><div class="line">3.CMD command param1 param2 (shell form)</div></pre></td></tr></table></figure>
<p>如：<code>CMD [&quot;/bin/echo&quot;, &quot;this is a echo test&quot;]</code>, docker run: <code>docker run imagename</code>后输出: <code>this is a echo test</code>   </p>
<p>docker run命令如果指定了参数会把CMD里的参数覆盖<br>如：<code>docker run imagename /bin/bash</code>, 就不会输出：this is a echo test，因为CMD命令被”/bin/bash”覆盖了   </p>
<h3 id="2-ENTRYPOINT"><a href="#2-ENTRYPOINT" class="headerlink" title="2.ENTRYPOINT"></a>2.ENTRYPOINT</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">An ENTRYPOINT allows you to configure a container that will run as an executable.</div><div class="line">它可以让你的容器功能表现得像一个可执行程序一样。</div><div class="line"></div><div class="line">1.ENTRYPOINT [&quot;executable&quot;, &quot;param1&quot;, &quot;param2&quot;] (exec form, preferred)</div><div class="line">2.ENTRYPOINT command param1 param2 (shell form)</div></pre></td></tr></table></figure>
<p>如：<code>ENTRYPOINT [&quot;/bin/echo&quot;]</code>，那么build出来的镜像以后的容器功能就像一个/bin/echo程序<br><code>docker run -it imagename &quot;this is a test&quot;</code>就等于<code>/bin/echo &quot;this is a test&quot;</code></p>
<p>注：<br>1.ENTRYPOINT有两种写法，第二种(shell form)会屏蔽掉docker run时后面加的命令和CMD里的参数。<br>2.Dockerfile中同时有ENTRYPOINT和CMD，是将CMD当参数传入ENTRYPOINT</p>
<h3 id="3-Demo"><a href="#3-Demo" class="headerlink" title="3.Demo"></a>3.Demo</h3><p>Dockefile<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">FROM debian:latest</div><div class="line"></div><div class="line">ADD entypoint.sh /entypoint.sh</div><div class="line">ADD run.sh /run.sh</div><div class="line">RUN chmod 755 /*.sh</div><div class="line"></div><div class="line">ENTRYPOINT [&quot;/entypoint.sh&quot;]</div><div class="line">CMD [/run.sh]</div></pre></td></tr></table></figure></p>
<p>run.sh<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash</div><div class="line"></div><div class="line">echo &quot;=&gt; do run.sh!&quot;</div></pre></td></tr></table></figure></p>
<p>entypoint.sh<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash</div><div class="line"></div><div class="line">echo &quot;=&gt; do entypoint.sh!&quot;</div><div class="line">echo &quot;=&gt; Quoted Values: $*&quot;</div></pre></td></tr></table></figure></p>
<p>Biuld &amp;&amp; Run<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo docker build -t debian:test .</div><div class="line">sudo docker run --rm debian:test</div></pre></td></tr></table></figure></p>
<p>1.当<code>ENTRYPOINT [&quot;/entypoint.sh&quot;]</code>和<code>CMD [&quot;/run.sh&quot;]</code>，输出结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">=&gt; do entypoint.sh!</div><div class="line">=&gt; Quoted Values: /run.sh</div></pre></td></tr></table></figure></p>
<p>2.当<code>ENTRYPOINT /entypoint.sh</code>和<code>CMD [&quot;/run.sh&quot;]</code>，输出结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">=&gt; do entypoint.sh!</div><div class="line">=&gt; Quoted Values:</div></pre></td></tr></table></figure></p>
<p>3.当<code>ENTRYPOINT [&quot;/entypoint.sh&quot;]</code>和<code>CMD /run.sh</code>，输出结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">=&gt; do entypoint.sh!</div><div class="line">=&gt; Quoted Values: /bin/sh -c /run.sh</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://deweing.github.io/2017/01/24/git-reset-remote-url/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="DW">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars1.githubusercontent.com/u/2382711">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hello World">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/24/git-reset-remote-url/" itemprop="url">
                  Git切换远程仓库地址
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-01-25T00:00:00+08:00">
                2017-01-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/工具/" itemprop="url" rel="index">
                    <span itemprop="name">工具</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>使用git时，免不了要修改远程仓库地址，下面有3钟方法可以修改：</p>
<h3 id="1-修改命令"><a href="#1-修改命令" class="headerlink" title="1.修改命令"></a>1.修改命令</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git remote set-url origin [url]</div></pre></td></tr></table></figure>
<h3 id="2-先删后加"><a href="#2-先删后加" class="headerlink" title="2.先删后加"></a>2.先删后加</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">git remote rm origin</div><div class="line">git remote add origin [url]</div><div class="line">git push -u origin --all</div><div class="line">git push -u origin --tags</div></pre></td></tr></table></figure>
<h3 id="3-修改config文件"><a href="#3-修改config文件" class="headerlink" title="3.修改config文件"></a>3.修改config文件</h3><p>在.git文件夹下找到config文件，修改remote.origin.url</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://deweing.github.io/2016/09/27/elk-optimize/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="DW">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars1.githubusercontent.com/u/2382711">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hello World">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/27/elk-optimize/" itemprop="url">
                  elasticseaerch调优
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-09-28T00:00:00+08:00">
                2016-09-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>elasticsearch</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://deweing.github.io/2016/09/20/iptabes-usage/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="DW">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars1.githubusercontent.com/u/2382711">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hello World">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/20/iptabes-usage/" itemprop="url">
                  Iptables用法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-09-21T00:00:00+08:00">
                2016-09-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-常用命令"><a href="#1-常用命令" class="headerlink" title="1.常用命令"></a>1.常用命令</h3><p>查看filter规则</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">iptables -L -n</div></pre></td></tr></table></figure>
<p>保存规则</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">iptables-save</div><div class="line">iptables-save &gt; /etc/sysconfig/iptables</div></pre></td></tr></table></figure>
<p>删除规则</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">iptables -D INPUT 3</div></pre></td></tr></table></figure>
<p>恢复规则</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">iptables-restore /etc/sysconfig/iptables</div></pre></td></tr></table></figure>
<h3 id="2-example"><a href="#2-example" class="headerlink" title="2.example"></a>2.example</h3><p>封ip</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">iptables -I INPUT -s 211.1.0.0 -j DROP</div><div class="line">iptables -I INPUT -s 211.1.0.0/16 -j DROP</div></pre></td></tr></table></figure>
<p>针对指定端口，限制ip访问</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">#先要关闭所有的9200端口</div><div class="line">iptables -I INPUT -p tcp --dport 9200 -j DROP</div><div class="line"></div><div class="line">#再开启允许访问的ip段</div><div class="line">iptables -I INPUT -s 172.17.0.1/24 -p tcp --dport 9200 -j ACCEPT</div><div class="line">iptables -I INPUT -s 172.22.4.1 -p tcp --dport 9200 -j ACCEPT</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://deweing.github.io/2016/07/27/elkstack-guide/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="DW">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars1.githubusercontent.com/u/2382711">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hello World">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/27/elkstack-guide/" itemprop="url">
                  Elasticsearch入坑指北
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-07-28T00:00:00+08:00">
                2016-07-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-安装"><a href="#1-安装" class="headerlink" title="1. 安装"></a>1. 安装</h3><p>Elasticsearch,Logstash,Kibana 安装其实还挺简单，只需要java7以上的版本支持即可；</p>
<h3 id="2-配置"><a href="#2-配置" class="headerlink" title="2. 配置"></a>2. 配置</h3><h4 id="2-1-Elasticsearch"><a href="#2-1-Elasticsearch" class="headerlink" title="2.1. Elasticsearch"></a>2.1. Elasticsearch</h4><ul>
<li>es不能以root用户启动，所以最好为elk创建单独的用户</li>
<li>内存分配，有两种方式修改Elasticsearch的堆内存：<ul>
<li>第一种比较简单，指定ES_HEAP_SIZE环境变量：export ES_HEAP_SIZE=10g</li>
<li>第二种通过命令行参数的形式，在程序启动的时候把内存大小传递给它：./bin/elasticsearch -Xmx10g -Xms10g</li>
</ul>
</li>
<li>调整线程池，修改config/elasticsearch.yml文件  </li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="string">threadpool.index.type:</span> <span class="string">fixed</span></div><div class="line"><span class="comment"># 池大小：建议2~3倍cpu数</span></div><div class="line"><span class="string">threadpool.index.size:</span> <span class="number">24</span></div><div class="line"><span class="string">threadpool.index.queue_size:</span> <span class="number">1000</span></div><div class="line"></div><div class="line"><span class="string">threadpool.search.type:</span> <span class="string">fixed</span></div><div class="line"><span class="comment"># 池大小：建议2~3倍cpu数</span></div><div class="line"><span class="string">threadpool.search.size:</span> <span class="number">24</span></div><div class="line"><span class="string">threadpool.search.queue_size:</span> <span class="number">1000</span></div><div class="line"><span class="string">```</span>  </div><div class="line"></div><div class="line"><span class="comment">#### 2.2. Logstash  </span></div><div class="line"><span class="bullet">-</span> <span class="string">在LOGSTASH_HOME/conf下，创建logstash.conf</span></div><div class="line"></div><div class="line"><span class="string">```sh</span></div><div class="line"><span class="string">input</span> <span class="string">&#123;</span></div><div class="line">    <span class="string">tcp</span> <span class="string">&#123;</span></div><div class="line">        <span class="string">mode</span> <span class="string">=&gt;</span> <span class="string">'server'</span></div><div class="line">        <span class="string">port</span>  <span class="string">=&gt;</span> <span class="number">8866</span></div><div class="line">        <span class="string">codec</span> <span class="string">=&gt;</span> <span class="string">"json"</span></div><div class="line">    <span class="string">&#125;</span></div><div class="line"><span class="string">&#125;</span></div><div class="line"></div><div class="line"><span class="string">output</span> <span class="string">&#123;</span></div><div class="line">    <span class="string">elasticsearch</span> <span class="string">&#123;</span></div><div class="line">        <span class="string">hosts</span> <span class="string">=&gt;</span> <span class="string">["elasticsearch:9200"]</span></div><div class="line">        <span class="string">index</span> <span class="string">=&gt;</span> <span class="string">"truck-<span class="template-variable">%&#123;+yyyy.MM.dd&#125;</span>"</span></div><div class="line">        <span class="string">workers</span> <span class="string">=&gt;</span> <span class="number">1</span></div><div class="line">        <span class="string">flush_size</span> <span class="string">=&gt;</span> <span class="number">20000</span></div><div class="line">        <span class="string">idle_flush_time</span> <span class="string">=&gt;</span> <span class="number">10</span></div><div class="line">        <span class="string">template_overwrite</span> <span class="string">=&gt;</span> <span class="literal">true</span></div><div class="line">    <span class="string">&#125;</span></div><div class="line"><span class="string">&#125;</span></div></pre></td></tr></table></figure>
<h4 id="2-3-Kibana"><a href="#2-3-Kibana" class="headerlink" title="2.3. Kibana"></a>2.3. Kibana</h4><ul>
<li>在config/kibana.yml文件里，修改elasticsearch.url配置</li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># The Elasticsearch instance to use for all your queries.</span></div><div class="line"><span class="string">elasticsearch.url:</span> <span class="string">"http://elasticsearch:9200"</span></div></pre></td></tr></table></figure>
<h3 id="3-使用"><a href="#3-使用" class="headerlink" title="3. 使用"></a>3. 使用</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">curl -XDELETE <span class="string">'http://localhost:9200/truck-*?pretty'</span></div><div class="line"></div><div class="line">curl -XPUT <span class="string">'http://localhost:9200/_template/truck?pretty'</span> -d@/opt/elasticsearch/templates/truck.template.json</div><div class="line"></div><div class="line">curl -XGET <span class="string">'http://localhost:9200/truck-*/_search?pretty'</span> -d <span class="string">'</span></div><div class="line">&#123;   </div><div class="line">    "from": 0,</div><div class="line">    "size": 10,</div><div class="line">    "query" : &#123;</div><div class="line">        "match" : &#123;</div><div class="line">          "level" : "TRACE"</div><div class="line">        &#125;</div><div class="line">    &#125;,</div><div class="line">    "sort": [</div><div class="line">        &#123; "totalTime" : "desc" &#125;</div><div class="line">    ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://deweing.github.io/2016/07/05/optimizing-mysql-configuration/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="DW">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars1.githubusercontent.com/u/2382711">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hello World">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/05/optimizing-mysql-configuration/" itemprop="url">
                  MySQL配置优化
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-07-06T00:00:00+08:00">
                2016-07-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="配置说明"><a href="#配置说明" class="headerlink" title="配置说明"></a>配置说明</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div></pre></td><td class="code"><pre><div class="line">[client]</div><div class="line">port = 3306  </div><div class="line">socket = /var/lib/mysql/mysql.sock</div><div class="line"></div><div class="line">[mysql]</div><div class="line"><span class="comment">#这个配置段设置启动MySQL服务的条件；在这种情况下，no-auto-rehash确保这个服务启动得比较快。</span></div><div class="line">no-auto-rehash</div><div class="line"></div><div class="line">[mysqld]</div><div class="line">user = mysql  </div><div class="line">port = 3306  </div><div class="line">socket = /var/lib/mysql/mysql.sock  </div><div class="line">basedir = /usr/<span class="built_in">local</span>/mysql  </div><div class="line">datadir = /data/mysql/data/  </div><div class="line">open_files_limit = 10240</div><div class="line"></div><div class="line">back_log = 600  </div><div class="line"><span class="comment">#在MYSQL暂时停止响应新请求之前，短时间内的多少个请求可以被存在堆栈中。如果系统在短时间内有很多连接，则需要增大该参数的值，该参数值指定到来的TCP/IP连接的监听队列的大小。默认值80。</span></div><div class="line"></div><div class="line">max_connections = 3000  </div><div class="line"><span class="comment">#MySQL允许最大的进程连接数，如果经常出现Too Many Connections的错误提示，则需要增大此值。默认151</span></div><div class="line"></div><div class="line">max_connect_errors = 6000  </div><div class="line"><span class="comment">#设置每个主机的连接请求异常中断的最大次数，当超过该次数，MYSQL服务器将禁止host的连接请求，直到mysql服务器重启或通过flush hosts命令清空此host的相关信息。默认100</span></div><div class="line"></div><div class="line">external-locking = FALSE  </div><div class="line"><span class="comment">#使用–skip-external-locking MySQL选项以避免外部锁定。该选项默认开启</span></div><div class="line"></div><div class="line">max_allowed_packet = 32M  </div><div class="line"><span class="comment">#设置在网络传输中一次消息传输量的最大值。系统默认值 为4MB，最大值是1GB，必须设置1024的倍数。</span></div><div class="line"></div><div class="line"><span class="comment">#sort_buffer_size = 2M  </span></div><div class="line"><span class="comment"># Sort_Buffer_Size 是一个connection级参数，在每个connection（session）第一次需要使用这个buffer的时候，一次性分配设置的内存。</span></div><div class="line"><span class="comment">#Sort_Buffer_Size 并不是越大越好，由于是connection级的参数，过大的设置+高并发可能会耗尽系统内存资源。例如：500个连接将会消耗 500*sort_buffer_size(8M)=4G内存</span></div><div class="line"><span class="comment">#Sort_Buffer_Size 超过2KB的时候，就会使用mmap() 而不是 malloc() 来进行内存分配，导致效率降低。 系统默认2M，使用默认值即可</span></div><div class="line"></div><div class="line"><span class="comment">#join_buffer_size = 2M  </span></div><div class="line"><span class="comment">#用于表间关联缓存的大小，和sort_buffer_size一样，该参数对应的分配内存也是每个连接独享。系统默认2M，使用默认值即可</span></div><div class="line"></div><div class="line">thread_cache_size = 300  </div><div class="line"><span class="comment">#默认38</span></div><div class="line"><span class="comment"># 服务器线程缓存这个值表示可以重新利用保存在缓存中线程的数量,当断开连接时如果缓存中还有空间,那么客户端的线程将被放到缓存中,如果线程重新被请求，那么请求将从缓存中读取,如果缓存中是空的或者是新的请求，那么这个线程将被重新创建,如果有很多新的线程，增加这个值可以改善系统性能.通过比较 Connections 和 Threads_created 状态的变量，可以看到这个变量的作用。设置规则如下：1GB 内存配置为8，2GB配置为16，3GB配置为32，4GB或更高内存，可配置更大。</span></div><div class="line"></div><div class="line"><span class="comment">#thread_concurrency = 8  </span></div><div class="line"><span class="comment">#系统默认为10，使用10先观察</span></div><div class="line"><span class="comment"># 设置thread_concurrency的值的正确与否, 对mysql的性能影响很大, 在多个cpu(或多核)的情况下，错误设置了thread_concurrency的值, 会导致mysql不能充分利用多cpu(或多核), 出现同一时刻只能一个cpu(或核)在工作的情况。thread_concurrency应设为CPU核数的2倍. 比如有一个双核的CPU, 那么thread_concurrency的应该为4; 2个双核的cpu, thread_concurrency的值应为8</span></div><div class="line"></div><div class="line">query_cache_size = 64M  </div><div class="line"><span class="comment">#在MyISAM引擎优化中，这个参数也是一个重要的优化参数。但也爆露出来一些问题。机器的内存越来越大，习惯性把参数分配的值越来越大。这个参数加大后也引发了一系列问题。我们首先分析一下 query_cache_size的工作原理：一个SELECT查询在DB中工作后，DB会把该语句缓存下来，当同样的一个SQL再次来到DB里调用时，DB在该表没发生变化的情况下把结果从缓存中返回给Client。这里有一个关建点，就是DB在利用Query_cache工作时，要求该语句涉及的表在这段时间内没有发生变更。那如果该表在发生变更时，Query_cache里的数据又怎么处理呢？首先要把Query_cache和该表相关的语句全部置为失效，然后在写入更新。那么如果Query_cache非常大，该表的查询结构又比较多，查询语句失效也慢，一个更新或是Insert就会很慢，这样看到的就是Update或是Insert怎么这么慢了。所以在数据库写入量或是更新量也比较大的系统，该参数不适合分配过大。而且在高并发，写入量大的系统，建议把该功能禁掉。</span></div><div class="line"></div><div class="line">query_cache_limit = 4M  </div><div class="line"><span class="comment">#指定单个查询能够使用的缓冲区大小，缺省为1M</span></div><div class="line"></div><div class="line">query_cache_min_res_unit = 2k  </div><div class="line"><span class="comment">#默认是4KB，设置值大对大数据查询有好处，但如果你的查询都是小数据查询，就容易造成内存碎片和浪费</span></div><div class="line"><span class="comment">#查询缓存碎片率 = Qcache_free_blocks / Qcache_total_blocks * 100%</span></div><div class="line"><span class="comment">#如果查询缓存碎片率超过20%，可以用FLUSH QUERY CACHE整理缓存碎片，或者试试减小query_cache_min_res_unit，如果你的查询都是小数据量的话。</span></div><div class="line"><span class="comment">#查询缓存利用率 = (query_cache_size – Qcache_free_memory) / query_cache_size * 100%</span></div><div class="line"><span class="comment">#查询缓存利用率在25%以下的话说明query_cache_size设置的过大，可适当减小;查询缓存利用率在80%以上而且Qcache_lowmem_prunes &gt; 50的话说明query_cache_size可能有点小，要不就是碎片太多。</span></div><div class="line"><span class="comment">#查询缓存命中率 = (Qcache_hits – Qcache_inserts) / Qcache_hits * 100%</span></div><div class="line"></div><div class="line"><span class="comment">#default-storage-engine = MyISAM</span></div><div class="line"><span class="comment">#default_table_type = InnoDB #开启失败</span></div><div class="line"></div><div class="line"><span class="comment">#thread_stack = 192K  </span></div><div class="line"><span class="comment">#设置MYSQL每个线程的堆栈大小，默认值足够大，可满足普通操作。可设置范围为128K至4GB，默认为256KB，使用默认观察</span></div><div class="line"></div><div class="line">transaction_isolation = READ-COMMITTED  </div><div class="line"><span class="comment"># 设定默认的事务隔离级别.可用的级别如下:READ UNCOMMITTED-读未提交 READ COMMITTE-读已提交 REPEATABLE READ -可重复读 SERIALIZABLE -串行</span></div><div class="line"></div><div class="line">tmp_table_size = 256M  </div><div class="line"><span class="comment"># tmp_table_size 的默认大小是 32M。如果一张临时表超出该大小，MySQL产生一个 The table tbl_name is full 形式的错误，如果你做很多高级 GROUP BY 查询，增加 tmp_table_size 值。如果超过该值，则会将临时表写入磁盘。</span></div><div class="line">max_heap_table_size = 256M</div><div class="line"></div><div class="line">expire_logs_days = 7  </div><div class="line">key_buffer_size = 2048M  </div><div class="line"><span class="comment">#批定用于索引的缓冲区大小，增加它可以得到更好的索引处理性能，对于内存在4GB左右的服务器来说，该参数可设置为256MB或384MB。</span></div><div class="line"></div><div class="line">read_buffer_size = 1M  </div><div class="line"><span class="comment">#默认128K</span></div><div class="line"><span class="comment"># MySql读入缓冲区大小。对表进行顺序扫描的请求将分配一个读入缓冲区，MySql会为它分配一段内存缓冲区。read_buffer_size变量控制这一缓冲区的大小。如果对表的顺序扫描请求非常频繁，并且你认为频繁扫描进行得太慢，可以通过增加该变量值以及内存缓冲区大小提高其性能。和sort_buffer_size一样，该参数对应的分配内存也是每个连接独享。</span></div><div class="line"></div><div class="line">read_rnd_buffer_size = 16M  </div><div class="line"><span class="comment"># MySql的随机读（查询操作）缓冲区大小。当按任意顺序读取行时(例如，按照排序顺序)，将分配一个随机读缓存区。进行排序查询时，MySql会首先扫描一遍该缓冲，以避免磁盘搜索，提高查询速度，如果需要排序大量数据，可适当调高该值。但MySql会为每个客户连接发放该缓冲空间，所以应尽量适当设置该值，以避免内存开销过大。</span></div><div class="line"></div><div class="line">bulk_insert_buffer_size = 64M  </div><div class="line"><span class="comment">#批量插入数据缓存大小，可以有效提高插入效率，默认为8M</span></div><div class="line"></div><div class="line">myisam_sort_buffer_size = 128M  </div><div class="line"><span class="comment"># MyISAM表发生变化时重新排序所需的缓冲 默认8M</span></div><div class="line"></div><div class="line">myisam_max_sort_file_size = 10G  </div><div class="line"><span class="comment"># MySQL重建索引时所允许的最大临时文件的大小 (当 REPAIR, ALTER TABLE 或者 LOAD DATA INFILE).</span></div><div class="line"><span class="comment"># 如果文件大小比此值更大,索引会通过键值缓冲创建(更慢)</span></div><div class="line"></div><div class="line"><span class="comment">#myisam_max_extra_sort_file_size = 10G 5.6无此值设置</span></div><div class="line"><span class="comment">#myisam_repair_threads = 1   默认为1</span></div><div class="line"><span class="comment"># 如果一个表拥有超过一个索引, MyISAM 可以通过并行排序使用超过一个线程去修复他们.</span></div><div class="line"><span class="comment"># 这对于拥有多个CPU以及大量内存情况的用户,是一个很好的选择.</span></div><div class="line"></div><div class="line">myisam_recover  </div><div class="line"><span class="comment">#自动检查和修复没有适当关闭的 MyISAM 表</span></div><div class="line">skip-name-resolve  </div><div class="line">lower_case_table_names = 1  </div><div class="line">server-id = 1</div><div class="line"></div><div class="line">innodb_additional_mem_pool_size = 16M  </div><div class="line"><span class="comment">#这个参数用来设置 InnoDB 存储的数据目录信息和其它内部数据结构的内存池大小，类似于Oracle的library cache。这不是一个强制参数，可以被突破。</span></div><div class="line"></div><div class="line">innodb_buffer_pool_size = 2048M  </div><div class="line"><span class="comment"># 这对Innodb表来说非常重要。Innodb相比MyISAM表对缓冲更为敏感。MyISAM可以在默认的 key_buffer_size 设置下运行的可以，然而Innodb在默认的 innodb_buffer_pool_size 设置下却跟蜗牛似的。由于Innodb把数据和索引都缓存起来，无需留给操作系统太多的内存，因此如果只需要用Innodb的话则可以设置它高达 70-80% 的可用内存。一些应用于 key_buffer 的规则有 — 如果你的数据量不大，并且不会暴增，那么无需把 innodb_buffer_pool_size 设置的太大了</span></div><div class="line"></div><div class="line"><span class="comment">#innodb_data_file_path = ibdata1:1024M:autoextend 设置过大导致报错，默认12M观察</span></div><div class="line"><span class="comment">#表空间文件 重要数据</span></div><div class="line"></div><div class="line"><span class="comment">#innodb_file_io_threads = 4   不明确，使用默认值</span></div><div class="line"><span class="comment">#文件IO的线程数，一般为 4，但是在 Windows 下，可以设置得较大。</span></div><div class="line"></div><div class="line"></div><div class="line">innodb_thread_concurrency = 8  </div><div class="line"><span class="comment">#服务器有几个CPU就设置为几，建议用默认设置，一般为8.</span></div><div class="line"></div><div class="line">innodb_flush_log_at_trx_commit = 2  </div><div class="line"><span class="comment"># 如果将此参数设置为1，将在每次提交事务后将日志写入磁盘。为提供性能，可以设置为0或2，但要承担在发生故障时丢失数据的风险。设置为0表示事务日志写入日志文件，而日志文件每秒刷新到磁盘一次。设置为2表示事务日志将在提交时写入日志，但日志文件每次刷新到磁盘一次。</span></div><div class="line"></div><div class="line"><span class="comment">#innodb_log_buffer_size = 16M   使用默认8M</span></div><div class="line"><span class="comment">#此参数确定些日志文件所用的内存大小，以M为单位。缓冲区更大能提高性能，但意外的故障将会丢失数据.MySQL开发人员建议设置为1－8M之间</span></div><div class="line"></div><div class="line"><span class="comment">#innodb_log_file_size = 128M  使用默认48M</span></div><div class="line"><span class="comment">#此参数确定数据日志文件的大小，以M为单位，更大的设置可以提高性能，但也会增加恢复故障数据库所需的时间</span></div><div class="line"></div><div class="line"><span class="comment">#innodb_log_files_in_group = 3   使用默认2</span></div><div class="line"><span class="comment">#为提高性能，MySQL可以以循环方式将日志文件写到多个文件。推荐设置为3M</span></div><div class="line"></div><div class="line"><span class="comment">#innodb_max_dirty_pages_pct = 90  使用默认75观察</span></div><div class="line"><span class="comment">#推荐阅读 http://www.taobaodba.com/html/221_innodb_max_dirty_pages_pct_checkpoint.html</span></div><div class="line"><span class="comment"># Buffer_Pool中Dirty_Page所占的数量，直接影响InnoDB的关闭时间。参数innodb_max_dirty_pages_pct 可以直接控制了Dirty_Page在Buffer_Pool中所占的比率，而且幸运的是innodb_max_dirty_pages_pct是可以动态改变的。所以，在关闭InnoDB之前先将innodb_max_dirty_pages_pct调小，强制数据块Flush一段时间，则能够大大缩短 MySQL关闭的时间。</span></div><div class="line"></div><div class="line">innodb_lock_wait_timeout = 120  </div><div class="line"><span class="comment">#默认为50秒 </span></div><div class="line"><span class="comment"># InnoDB 有其内置的死锁检测机制，能导致未完成的事务回滚。但是，如果结合InnoDB使用MyISAM的lock tables 语句或第三方事务引擎,则InnoDB无法识别死锁。为消除这种可能性，可以将innodb_lock_wait_timeout设置为一个整数值，指示 MySQL在允许其他事务修改那些最终受事务回滚的数据之前要等待多长时间(秒数)</span></div><div class="line"></div><div class="line">innodb_file_per_table = 0  </div><div class="line"><span class="comment">#默认为No</span></div><div class="line"><span class="comment">#独享表空间（关闭）</span></div><div class="line"></div><div class="line">[mysqldump]</div><div class="line">quick  </div><div class="line"><span class="comment"># max_allowed_packet = 32M</span></div><div class="line"></div><div class="line">[mysqld_safe]</div><div class="line"><span class="built_in">log</span>-error=/data/mysql/mysql_oldboy.err  </div><div class="line">pid-file=/data/mysql/mysqld.pid</div><div class="line"></div><div class="line">sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://deweing.github.io/2016/06/28/mycat-install-log/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="DW">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars1.githubusercontent.com/u/2382711">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hello World">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/28/mycat-install-log/" itemprop="url">
                  Mycat安装配置记录
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-06-29T00:00:00+08:00">
                2016-06-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-安装JDK"><a href="#1-安装JDK" class="headerlink" title="1.安装JDK"></a>1.安装JDK</h3><p>注：JDK7或者更高版本</p>
<h3 id="2-安装MySQL"><a href="#2-安装MySQL" class="headerlink" title="2.安装MySQL"></a>2.安装MySQL</h3><p>MYCAT支持多种数据库，如：MySQL、SQLServer、Oracle、MongoDB<br><strong>注意</strong>：Linux下部署安装MySQL，默认不忽略表名大小写，需要修改my.cnf配置：<code>lower_case_table_names=1</code> 忽略表名大小写，否则MyCat会提示找不到表的错误！</p>
<h3 id="3-安装MyCat"><a href="#3-安装MyCat" class="headerlink" title="3.安装MyCat"></a>3.安装MyCat</h3><p>下载地址：<a href="https://github.com/MyCATApache/Mycat-download" target="_blank" rel="external">https://github.com/MyCATApache/Mycat-download</a><br>将Mycat-server-xxxxx.linux.tar.gz解压到指定的目录下，目录不能有空格，linux下，建议放在usr/local/Mycat目录下</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">useradd Mycat</div><div class="line">chown -R Mycat:Mycat /usr/<span class="built_in">local</span>/Mycat</div></pre></td></tr></table></figure>
<h3 id="4-配置与启动"><a href="#4-配置与启动" class="headerlink" title="4.配置与启动"></a>4.配置与启动</h3><ul>
<li>在linux环境变量中配置MYCAT_HOME<ul>
<li><code>vi /etc/profile</code>，在系统环境变量中添加<code>MYCAT_HOME=/usr/loca/Mycat</code></li>
<li>执行生效：<code>source /etc/profile</code></li>
</ul>
</li>
<li>mycat配置文件:<ul>
<li>MYCAT_HOME/conf/schema.xml；定义逻辑库、表、分片节点等内容</li>
<li>MYCAT_HOME/conf/server.xml：定义用户及系统相关变量，如端口等</li>
<li>MYCAT_HOME/conf/rule.xml：定义分片规则</li>
</ul>
</li>
<li><p>在/usr/local/Mycat/bin目录下执行：<code>./mycat start</code></p>
<p>即可启动mycat服务</p>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://deweing.github.io/2016/06/28/mycat-auto-increment/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="DW">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars1.githubusercontent.com/u/2382711">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hello World">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/28/mycat-auto-increment/" itemprop="url">
                  Mycat自增主键设置
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-06-29T00:00:00+08:00">
                2016-06-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>1.在server.xml中，将sequnceHandlerType设置为1</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sequnceHandlerType"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div></pre></td></tr></table></figure>
<p>2.在schema.xml中，table中增加属性autoIncrement值为true，添加mycat_sequence表</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">schema</span> <span class="attr">name</span>=<span class="string">"TESTDB"</span> <span class="attr">checkSQLschema</span>=<span class="string">"false"</span> <span class="attr">sqlMaxLimit</span>=<span class="string">"100"</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- random sharding using mod sharind rule --&gt;</span></div><div class="line">    <span class="comment">&lt;!-- autoIncrement="true" 属性--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">"tt2"</span> <span class="attr">primaryKey</span>=<span class="string">"id"</span> <span class="attr">autoIncrement</span>=<span class="string">"true"</span> <span class="attr">dataNode</span>=<span class="string">"dn1,dn2,dn3,dn4,dn5"</span> <span class="attr">rule</span>=<span class="string">"mod-long"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">"mycat_sequence"</span> <span class="attr">primaryKey</span>=<span class="string">"name"</span> <span class="attr">dataNode</span>=<span class="string">"dn1"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">schema</span>&gt;</span></div></pre></td></tr></table></figure>
<p>3.在sequence_db_conf.properties中，依赖全局序列，增加序列，与table名称相同全大写</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">TT2=dn1</div></pre></td></tr></table></figure>
<p>4.创建mycat_sequence表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> MYCAT_SEQUENCE;</div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> MYCAT_SEQUENCE(</div><div class="line">    <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</div><div class="line">    current_value <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</div><div class="line">    <span class="keyword">increment</span> <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">100</span>,</div><div class="line">    PRIMARY <span class="keyword">KEY</span>(<span class="keyword">name</span>)</div><div class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span>;</div></pre></td></tr></table></figure>
<ul>
<li>name：sequence名称</li>
<li>currenct_value：当前value</li>
<li>increment：增长步长<br>注：MYCAT_SEQUENCE必须大写</li>
</ul>
<p>5.插入sequence记录</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> MYCAT_SEQUENCE(<span class="keyword">name</span>, current_value, <span class="keyword">increment</span>) <span class="keyword">VALUES</span> (<span class="string">'TT2'</span>, <span class="number">1</span>, <span class="number">100</span>);</div></pre></td></tr></table></figure>
<p>6.创建存储函数，必须在同一个数据库中创建</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="comment">-- 获取当前sequence的值 (返回当前值,增量)</span></div><div class="line"><span class="keyword">DROP</span> <span class="keyword">FUNCTION</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> mycat_seq_currval;</div><div class="line">DELIMITER $</div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> mycat_seq_currval(seq_name <span class="built_in">VARCHAR</span>(<span class="number">50</span>)) <span class="keyword">RETURNS</span> <span class="built_in">varchar</span>(<span class="number">64</span>) <span class="keyword">CHARSET</span> utf8</div><div class="line"><span class="keyword">DETERMINISTIC</span></div><div class="line"><span class="keyword">BEGIN</span></div><div class="line"><span class="keyword">DECLARE</span> retval <span class="built_in">VARCHAR</span>(<span class="number">64</span>);</div><div class="line"><span class="keyword">SET</span> retval=<span class="string">"-999999999,null"</span>;</div><div class="line"><span class="keyword">SELECT</span> <span class="keyword">concat</span>(<span class="keyword">CAST</span>(current_value <span class="keyword">AS</span> <span class="built_in">CHAR</span>),<span class="string">","</span>,<span class="keyword">CAST</span>(<span class="keyword">increment</span> <span class="keyword">AS</span> <span class="built_in">CHAR</span>)) <span class="keyword">INTO</span> retval <span class="keyword">FROM</span> MYCAT_SEQUENCE <span class="keyword">WHERE</span> <span class="keyword">name</span> = seq_name;</div><div class="line">RETURN retval;</div><div class="line"><span class="keyword">END</span> $</div><div class="line">DELIMITER ;</div><div class="line"></div><div class="line"><span class="comment">-- 设置sequence值</span></div><div class="line"><span class="keyword">DROP</span> <span class="keyword">FUNCTION</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> mycat_seq_setval;</div><div class="line">DELIMITER $</div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> mycat_seq_setval(seq_name <span class="built_in">VARCHAR</span>(<span class="number">50</span>),<span class="keyword">value</span> <span class="built_in">INTEGER</span>) <span class="keyword">RETURNS</span> <span class="built_in">varchar</span>(<span class="number">64</span>) <span class="keyword">CHARSET</span> utf8</div><div class="line"><span class="keyword">DETERMINISTIC</span></div><div class="line"><span class="keyword">BEGIN</span></div><div class="line"><span class="keyword">UPDATE</span> MYCAT_SEQUENCE</div><div class="line"><span class="keyword">SET</span> current_value = <span class="keyword">value</span></div><div class="line"><span class="keyword">WHERE</span> <span class="keyword">name</span> = seq_name;</div><div class="line">RETURN mycat_seq_currval(seq_name);</div><div class="line"><span class="keyword">END</span> $</div><div class="line">DELIMITER ;</div><div class="line"></div><div class="line"><span class="comment">-- 获取下一个sequence值</span></div><div class="line"><span class="keyword">DROP</span> <span class="keyword">FUNCTION</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> mycat_seq_nextval;</div><div class="line">DELIMITER $</div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> mycat_seq_nextval(seq_name <span class="built_in">VARCHAR</span>(<span class="number">50</span>)) <span class="keyword">RETURNS</span> <span class="built_in">varchar</span>(<span class="number">64</span>) <span class="keyword">CHARSET</span> utf8</div><div class="line"><span class="keyword">DETERMINISTIC</span></div><div class="line"><span class="keyword">BEGIN</span></div><div class="line"><span class="keyword">UPDATE</span> MYCAT_SEQUENCE</div><div class="line"><span class="keyword">SET</span> current_value = current_value + <span class="keyword">increment</span> <span class="keyword">WHERE</span> <span class="keyword">name</span> = seq_name;</div><div class="line">RETURN mycat_seq_currval(seq_name);</div><div class="line"><span class="keyword">END</span> $</div><div class="line">DELIMITER ;</div></pre></td></tr></table></figure>
<p>7.在mysql中定义自增主键</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`tt2`</span> (</div><div class="line">  <span class="string">`id`</span> <span class="built_in">INT</span>(<span class="number">10</span>) <span class="keyword">UNSIGNED</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</div><div class="line">  <span class="string">`nm`</span> <span class="built_in">INT</span>(<span class="number">10</span>) <span class="keyword">UNSIGNED</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</div><div class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</div><div class="line">) <span class="keyword">ENGINE</span>=MYISAM AUTO_INCREMENT=<span class="number">6</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</div></pre></td></tr></table></figure>
<p>8.插入记录</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tt2(nm) <span class="keyword">values</span> (<span class="number">99</span>);</div></pre></td></tr></table></figure>
<p>FROM:<br>1.<a href="https://github.com/MyCATApache/Mycat-doc/blob/master/MyCAT%E8%87%AA%E5%A2%9E%E5%AD%97%E6%AE%B5%E5%92%8C%E8%BF%94%E5%9B%9E%E7%94%9F%E6%88%90%E7%9A%84%E4%B8%BB%E9%94%AEID%E7%9A%84%E7%BB%8F%E9%AA%8C%E5%88%86%E4%BA%AB" target="_blank" rel="external">MyCAT自增字段和返回生成的主键ID的经验分享</a><br>2.<a href="http://valleylord.github.io/post/201603-mycat-perf-test/" target="_blank" rel="external">MyCAT 性能测试</a><br>3.<a href="http://www.songwie.com/articlelist/68" target="_blank" rel="external">mycat分布式mysql中间件（自增主键）</a><br>4.<a href="http://www.cnblogs.com/ivictor/p/5235147.html" target="_blank" rel="external">MyCAT全局序列号</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="https://avatars1.githubusercontent.com/u/2382711"
               alt="DW" />
          <p class="site-author-name" itemprop="name">DW</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">37</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">20</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">DW</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  




	





  





  





  






  





  

  

  

  

</body>
</html>
