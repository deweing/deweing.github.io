---
layout: post
title: 多终端管理器tmux使用详解
category: 工具
tags: linux
keywords: ssh
description:
---

tmux是一个优秀的终端复用软件，类似GNU Screen，但来自于OpenBSD，采用BSD授权。使用它最直观的好处就是，通过一个终端登录远程主机并运行tmux后，在其中可以开启多个控制台而无需再“浪费”多余的终端来连接这台远程主机；当然其功能远不止于此。

ubuntu可以使用sudo apt-get install tmux来安装。安装完成后输入命令tmux即可打开软件，界面十分简单，类似一个下方带有状态栏的终端控制台；但根据tmux的定义，在开启了tmux服务器后，会首先创建一个会话，而这个会话则会首先创建一个窗口，其中仅包含一个面板；也就是说，这里看到的所谓终端控制台应该称作tmux的一个面板，虽然其使用方法与终端控制台完全相同。

tmux使用C/S模型构建，主要包括以下单元模块：

<table class="table_border">
    <tbody>
        <tr>
            <td>server</td>
            <td>服务器。输入tmux命令时就开启了一个服务器。</td>
        </tr>
        <tr>
            <td >session</td>
            <td>会话。一个服务器可以包含多个会话。</td>
        </tr>
        <tr>
            <td >window</td>
            <td>窗口。一个会话可以包含多个窗口。</td>
        </tr>
        <tr>
            <td >pane</td>
            <td>面板。一个窗口可以包含多个面板。</td>
        </tr>
    </tbody>
</table>

## 会话

```
tmux new -s session #建立会话
tmux new -s session -d #在后台建立会话 
tmux ls #列出会话 
tmux attach -t session #进入某个会话 
```

## 操作

类似各种平铺式窗口管理器，tmux使用键盘操作，常用快捷键包括：

<table class="table_border" >
    <tbody>
        <tr>
            <td colspan="2">Ctrl+b</td>
            <td>激活控制台；此时以下按键生效</td>
        </tr>
        <tr>
            <td rowspan="9">系统操作</td>
            <td>?</td>
            <td>列出所有快捷键；按q返回</td>
        </tr>
        <tr>
            <td>d</td>
            <td>脱离当前会话；这样可以暂时返回Shell界面，输入tmux attach能够重新进入之前的会话</td>
        </tr>
        <tr>
            <td>D</td>
            <td>选择要脱离的会话；在同时开启了多个会话时使用</td>
        </tr>
        <tr>
            <td>Ctrl+z</td>
            <td>挂起当前会话</td>
        </tr>
        <tr>
            <td>r</td>
            <td>强制重绘未脱离的会话</td>
        </tr>
        <tr>
            <td>s</td>
            <td>选择并切换会话；在同时开启了多个会话时使用</td>
        </tr>
        <tr>
            <td>:</td>
            <td>进入命令行模式；此时可以输入支持的命令，例如kill-server可以关闭服务器</td>
        </tr>
        <tr>
            <td>[</td>
            <td>进入复制模式；此时的操作与vi/emacs相同，按q/Esc退出</td>
        </tr>
        <tr>
            <td >~</td>
            <td >列出提示信息缓存；其中包含了之前tmux返回的各种提示信息</td>
        </tr>
        <tr>
            <td rowspan="10">窗口操作</td>
            <td>c</td>
            <td>创建新窗口</td>
        </tr>
        <tr>
            <td>&amp;</td>
            <td>关闭当前窗口</td>
        </tr>
        <tr>
            <td>数字键</td>
            <td>切换至指定窗口</td>
        </tr>
        <tr>
            <td>p</td>
            <td>切换至上一窗口</td>
        </tr>
        <tr>
            <td>n</td>
            <td>切换至下一窗口</td>
        </tr>
        <tr>
            <td>l</td>
            <td>在前后两个窗口间互相切换</td>
        </tr>
        <tr>
            <td>w</td>
            <td>通过窗口列表切换窗口</td>
        </tr>
        <tr>
            <td>,</td>
            <td>重命名当前窗口；这样便于识别</td>
        </tr>
        <tr>
            <td>.</td>
            <td>修改当前窗口编号；相当于窗口重新排序</td>
        </tr>
        <tr>
            <td>f</td>
            <td>在所有窗口中查找指定文本</td>
        </tr>
        <tr>
            <td rowspan="14">面板操作</td>
            <td class="col1 centeralign">”</td>
            <td>将当前面板平分为上下两块</td>
        </tr>
        <tr>
            <td >%</td>
            <td >将当前面板平分为左右两块</td>
        </tr>
        <tr>
            <td >x</td>
            <td >关闭当前面板</td>
        </tr>
        <tr>
            <td >!</td>
            <td >将当前面板置于新窗口；即新建一个窗口，其中仅包含当前面板</td>
        </tr>
        <tr>
            <td >Ctrl+方向键</td>
            <td >以1个单元格为单位移动边缘以调整当前面板大小</td>
        </tr>
        <tr>
            <td >Alt+方向键</td>
            <td >以5个单元格为单位移动边缘以调整当前面板大小</td>
        </tr>
        <tr>
            <td >Space</td>
            <td >在预置的面板布局中循环切换；依次包括even-horizontal、even-vertical、main-horizontal、main-vertical、tiled</td>
        </tr>
        <tr>
            <td >q</td>
            <td >显示面板编号</td>
        </tr>
        <tr>
            <td >o</td>
            <td >在当前窗口中选择下一面板</td>
        </tr>
        <tr>
            <td >方向键</td>
            <td >移动光标以选择面板</td>
        </tr>
        <tr>
            <td >{</td>
            <td >向前置换当前面板</td>
        </tr>
        <tr>
            <td >}</td>
            <td >向后置换当前面板</td>
        </tr>
        <tr>
            <td >Alt+o</td>
            <td >逆时针旋转当前窗口的面板</td>
        </tr>
        <tr>
            <td >Ctrl+o</td>
            <td >顺时针旋转当前窗口的面板</td>
        </tr>
    </tbody>
</table>

## 配置

tmux的系统级配置文件为/etc/tmux.conf，用户级配置文件为~/.tmux.conf。没有该文件新建一个即可。配置文件实际上就是tmux的命令集合，也就是说每行配置均可在进入命令行模式后输入生效。

注意：更改配置之后需要重启tmux或者进入命令模式（按按键前缀后再按: )输入 source-file ~/.tmux.conf即可。

```
#将ctrl-r键设置为加载配置文件，并显示"reloaded!"信息
bind C-r source-file ~/.tmux.conf \; display "Reloaded!"
```

copy-mode(复制模式)

a.PREFIX [ 进入复制模式 
b.按 space 开始复制，移动光标选择复制区域 
c.按 Enter 复制并退出copy-mode。 
d.将光标移动到指定位置，按 PREIFX ] 粘贴 

在~/.tmux.conf中加入如下行，否则在VIM中复制模式无法完成操作 

```
setw -g mode-keys vi
```

重新连接到之前的窗口

```
tmux attach
```

不过如果没有会话会提示：

```
no sessions
```

修改Tmux配置如果无分离终端则新建，在.tmux.conf加入如下行：

```
#将ctrl-r键设置为加载配置文件，并显示"reloaded!"信息
bind C-r source-file ~/.tmux.conf \; display "Reloaded!"

#tmux attach 如果无分离终端则新建
new-session

#此类配置可以在命令行模式中输入show-options -g查询
set-option -g status-keys vi        #操作状态栏时的默认键盘布局；可以设置为vi或emacs
set-option -g status-utf8 on        #开启状态栏的UTF-8支持

#此类设置可以在命令行模式中输入show-window-options -g查询
set-window-option -g mode-keys vi    #复制模式中的默认键盘布局；可以设置为vi或emacs
set-window-option -g utf8 on        #开启窗口的UTF-8支持

#选择分割的窗格,不需要松开ctrl键，多次跳转更方便
bind C-k selectp -U            # 选择上窗格
bind C-j selectp -D            # 选择下窗格
bind C-h selectp -L            # 选择左窗格
bind C-l selectp -R            # 选择右窗格

#执行命令，比如 Manpage
bind m command-prompt "splitw -h 'exec man %%'"
```

Start tmux on every shell login

```
vi ~/.bashrc
```

添加：

```
# If not running interactively, do not do anything
[[ $- != *i* ]] && return
[[ $TERM != screen* ]] && exec tmux
```

详细参考：[https://wiki.archlinux.org/index.php/Tmux#Start_tmux_on_every_shell_login](https://wiki.archlinux.org/index.php/Tmux#Start_tmux_on_every_shell_login)

这样做，会使每一个该用户下的终端都进入tmux。如果需要ssh到其他机子上，进入其上的tmux 或 screen，会导致快捷键冲突以及显示混乱。

参考：

1.[https://wiki.freebsdchina.org/software/t/tmux?utm_source=twitterfeed&utm_medium=twitter](https://wiki.freebsdchina.org/software/t/tmux?utm_source=twitterfeed&utm_medium=twitter)
2.[http://linuxtoy.org/archives/from-screen-to-tmux.html](http://linuxtoy.org/archives/from-screen-to-tmux.html)
3.[http://linuxtoy.org/archives/from-screen-to-tmux.html](http://linuxtoy.org/archives/from-screen-to-tmux.html)
4.[http://os.51cto.com/art/200908/144275.htm](http://os.51cto.com/art/200908/144275.htm)
5.[http://blog.onovps.com/archives/tmux-attach.html](http://blog.onovps.com/archives/tmux-attach.html)
6.[http://tmux.sourceforge.net/](http://tmux.sourceforge.net/)
7.[http://www.cnblogs.com/congbo/archive/2012/08/30/2649420.html](http://www.cnblogs.com/congbo/archive/2012/08/30/2649420.html)